# Story 1.4: Office Add-in Manifest Creation

## Status

Draft

## Story

**As a** developer,
**I want** to create an Office Add-in manifest XML file,
**so that** the add-in can be sideloaded into Outlook Web Access.

## Acceptance Criteria

1. Created manifest XML file at `/outlook-addin/manifest/outlook-addin-manifest.xml`
2. Manifest includes required fields: ID (UUID), version, provider name, display name, description
3. Manifest specifies task pane source URL pointing to localhost HTTPS dev server
4. Manifest requests Mail.Read permission for accessing email metadata
5. Manifest specifies supported Outlook hosts: Outlook Web Access (desktop)
6. Manifest includes icon URLs (placeholder icons acceptable for MVP)
7. Manifest validates against Office Add-in schema (use Office Add-in Validator tool)
8. Created npm script to generate production manifest with Railway hosted URL
9. Documentation added: how to sideload manifest in Outlook Web for testing

## Tasks / Subtasks

- [ ] **Task 1: Create Manifest Directory Structure** (AC: 1)
  - [ ] Create `/outlook-addin/manifest` directory
  - [ ] Verify directory structure matches architecture specification from source-tree-organization.md
  - [ ] Update .gitignore if necessary to track manifest files (manifest XML should be committed)

- [ ] **Task 2: Create Development Manifest XML File** (AC: 1, 2, 3, 4, 5, 6)
  - [ ] Create `/outlook-addin/manifest/outlook-addin-manifest.xml` file
  - [ ] Generate UUID for manifest ID using `uuidgen` or online generator
  - [ ] Set manifest version to 1.0.0.0 (Office manifest version format)
  - [ ] Configure provider name: "ZO, LLC"
  - [ ] Set display name: "Email to Ticket Converter"
  - [ ] Add description: "Convert Outlook emails into support tickets with automatic contact matching"
  - [ ] Set task pane source URL to `https://localhost:5173` (matches Story 1.3 dev server)
  - [ ] Request Mail.Read permission in `<Permissions>` element
  - [ ] Specify supported host: Outlook Web Access in `<Hosts><Host Name="Mailbox">` element
  - [ ] Add placeholder icon URLs (use public placeholder image service or local placeholder)
  - [ ] Document manifest XML structure with inline comments for future reference

- [ ] **Task 3: Validate Manifest Against Office Add-in Schema** (AC: 7)
  - [ ] Install Office Add-in Validator tool: `npm install -g office-addin-manifest`
  - [ ] Run validation command: `office-addin-manifest validate outlook-addin/manifest/outlook-addin-manifest.xml`
  - [ ] Fix any validation errors reported by the validator
  - [ ] Verify manifest adheres to Office Add-in XML Schema 1.1
  - [ ] Document validation steps in add-in README.md

- [ ] **Task 4: Create Production Manifest Generation Script** (AC: 8)
  - [ ] Create npm script in `/outlook-addin/package.json`: `"manifest:prod"`
  - [ ] Script should copy development manifest and replace localhost URL with production URL
  - [ ] Production URL should be `https://outlook-addin.zollc.com` (from infrastructure-and-deployment-integration.md)
  - [ ] Script output file: `/outlook-addin/manifest/outlook-addin-manifest.prod.xml`
  - [ ] Test script execution: `npm run manifest:prod --workspace=outlook-addin`
  - [ ] Verify production manifest contains correct production URL
  - [ ] Add production manifest to .gitignore (generated file, not committed)

- [ ] **Task 5: Document Sideloading Instructions** (AC: 9)
  - [ ] Update `/outlook-addin/README.md` with sideloading section
  - [ ] Document steps to access Outlook Web (outlook.office.com)
  - [ ] Document how to navigate to "Get Add-ins" → "My add-ins" → "Add from file"
  - [ ] Document how to select manifest XML file for sideloading
  - [ ] Document how to verify add-in appears in Outlook Web sidebar
  - [ ] Include troubleshooting section for common sideloading errors
  - [ ] Add screenshots or links to Microsoft documentation for visual reference

- [ ] **Task 6: Manual Testing - Manifest Validation and Sideloading** (AC: 7, 9)
  - [ ] Verify manifest validates successfully with Office Add-in Validator
  - [ ] Attempt to sideload development manifest in Outlook Web Access
  - [ ] Verify add-in icon appears in Outlook Web toolbar/sidebar
  - [ ] Verify no XML parsing errors during sideload
  - [ ] Verify task pane URL points to localhost dev server (don't need to test full loading yet)
  - [ ] Document any issues encountered and resolutions in Dev Agent Record

## Dev Notes

### Previous Story Insights

**Story 1.3 (Add-in Project Setup):** Dev server configured to run at `https://localhost:5173` with self-signed SSL certificate. Office.js CDN script already added to HTML template. Project structure includes `/outlook-addin/src/components`, `/outlook-addin/src/lib`, `/outlook-addin/src/hooks`. [Source: [1.3.add-in-project-setup-development-environment.story.md](docs/outlook-addin/stories/1.3.add-in-project-setup-development-environment.story.md#dev-notes)]

**Story 1.2 (Authentication Strategy):** Session cookie authentication selected. Backend CORS already configured for cross-origin requests. Add-in will use `credentials: 'include'` in API requests. [Source: [1.2.authentication-strategy-research.story.md](docs/outlook-addin/stories/1.2.authentication-strategy-research.story.md#dev-agent-record)]

### Office Add-in Manifest Requirements

**Manifest Format:** Office Add-ins require an XML manifest file that defines add-in metadata, permissions, and hosting configuration. Manifest must validate against Office Add-in XML Schema version 1.1. [Source: Office.js documentation]

**Required Manifest Elements:**
- `<Id>`: UUID uniquely identifying the add-in (generate once, never change)
- `<Version>`: Manifest version in format `1.0.0.0` (Office-specific versioning)
- `<ProviderName>`: Organization name (use "ZO, LLC")
- `<DisplayName>`: Add-in name shown in Outlook UI ("Email to Ticket Converter")
- `<Description>`: Brief description of add-in functionality
- `<Hosts>`: Supported Office applications (Mailbox for Outlook)
- `<Permissions>`: Required Office.js API permissions (Mail.Read for email metadata)
- `<SourceLocation>`: HTTPS URL where add-in task pane is hosted

**Permission Level:** Manifest must request `Mail.Read` permission to access email sender, subject, and metadata via Office.js Mail API. This is the minimum permission level needed for contact matching functionality. [Source: Office.js Mail API documentation]

**Icon Requirements:** Manifest requires icon URLs for 16x16, 32x32, and 80x80 pixel icons. For MVP, placeholder icons are acceptable (can use public image URLs or data URIs). Production icons should match ZO, LLC branding. [Source: Office Add-in manifest schema]

### File Locations and Structure

**Manifest Directory:** Create `/outlook-addin/manifest` directory for manifest XML files. This directory should contain both development and production manifest versions. [Source: [source-tree-organization.md](docs/outlook-addin/architecture/source-tree-organization.md#new-file-organization-add-in-specific)]

**Development Manifest:**
- File: `/outlook-addin/manifest/outlook-addin-manifest.xml`
- Task pane URL: `https://localhost:5173` (matches Story 1.3 dev server)
- Should be committed to version control

**Production Manifest:**
- File: `/outlook-addin/manifest/outlook-addin-manifest.prod.xml`
- Task pane URL: `https://outlook-addin.zollc.com` (Railway deployment)
- Generated via npm script, should NOT be committed to git (add to .gitignore)

[Source: [source-tree-organization.md](docs/outlook-addin/architecture/source-tree-organization.md#new-file-organization-add-in-specific)]

### Deployment Infrastructure Context

**Production Hosting:** Add-in will be deployed to Railway service at `https://outlook-addin.zollc.com`. This service will serve static files from `/outlook-addin/dist` directory after production build. [Source: [infrastructure-and-deployment-integration.md](docs/outlook-addin/architecture/infrastructure-and-deployment-integration.md#enhancement-deployment-strategy)]

**Railway Service Configuration:**
- Service name: `outlook-addin`
- Custom domain: `outlook-addin.zollc.com`
- SSL: Auto-provisioned Let's Encrypt certificates
- Build command: `npm install && npm run build --workspace=outlook-addin`
- Start command: `npx serve -s outlook-addin/dist -p $PORT`

[Source: [infrastructure-and-deployment-integration.md](docs/outlook-addin/architecture/infrastructure-and-deployment-integration.md#railway-service-configuration)]

**Environment Variables:**
```bash
VITE_API_URL=https://ticketapi.zollc.com
NODE_ENV=production
```

[Source: [infrastructure-and-deployment-integration.md](docs/outlook-addin/architecture/infrastructure-and-deployment-integration.md#railway-service-configuration)]

### Manifest Validation and Sideloading

**Office Add-in Validator:** Microsoft provides `office-addin-manifest` npm package for validating manifest XML files. Install globally: `npm install -g office-addin-manifest`. Validate with: `office-addin-manifest validate <path-to-manifest.xml>`. [Source: Microsoft Office Add-in documentation]

**Sideloading Process (Development):**
1. Open Outlook Web Access at outlook.office.com
2. Navigate to "Get Add-ins" button in toolbar
3. Select "My add-ins" tab
4. Click "Add from file" and upload manifest XML
5. Verify add-in icon appears in Outlook sidebar

**Sideloading Requirements:**
- Manifest URL must be HTTPS (localhost with self-signed cert is acceptable for dev)
- Manifest must pass XML schema validation
- Task pane URL must be accessible from browser

[Source: Microsoft Office Add-in sideloading documentation]

### NPM Script for Production Manifest

**Manifest Generation Strategy:** Use npm script to generate production manifest by copying development manifest and replacing localhost URL with production URL. This avoids manual duplication and reduces chance of errors.

**Script Implementation Example:**
```json
{
  "scripts": {
    "manifest:prod": "sed 's|https://localhost:5173|https://outlook-addin.zollc.com|g' manifest/outlook-addin-manifest.xml > manifest/outlook-addin-manifest.prod.xml"
  }
}
```

**Note:** Cross-platform compatibility may require using Node.js script instead of shell commands. Consider using `fs` module for file operations.

### Integration with Existing Standards

**TypeScript Standards:** Manifest is XML, not TypeScript. No TypeScript standards apply to this story. [Source: [coding-standards-and-integration-rules.md](docs/outlook-addin/architecture/coding-standards-and-integration-rules.md#typescript-standards)]

**Office.js Integration:** Manifest enables Office.js API access by requesting Mail.Read permission. Office.js initialization code (Office.onReady()) already added in Story 1.3. [Source: [coding-standards-and-integration-rules.md](docs/outlook-addin/architecture/coding-standards-and-integration-rules.md#enhancement-specific-standards)]

**Error Handling:** Manifest validation errors should be caught and fixed before sideloading. Sideloading errors (XML parsing, permission errors) should be documented in README.md troubleshooting section. [Source: [coding-standards-and-integration-rules.md](docs/outlook-addin/architecture/coding-standards-and-integration-rules.md#error-handling)]

### Security Considerations

**HTTPS Requirement:** Office Add-ins MUST be served over HTTPS, even in development. Manifest SourceLocation must use HTTPS URLs. Self-signed certificates acceptable for localhost development. [Source: [security-integration.md](docs/outlook-addin/architecture/security-integration.md#enhancement-security-requirements)]

**Permission Scope:** Manifest requests Mail.Read permission, which grants read-only access to email metadata (sender, subject, body). This is the minimum permission needed for contact matching. No write permissions requested. [Source: Office.js security documentation]

**Icon URLs:** Manifest icon URLs should be HTTPS. For MVP, use public placeholder image service or data URI. Production icons should be hosted on same domain as add-in (`outlook-addin.zollc.com`). [Source: Office Add-in security best practices]

### Testing

**Testing Strategy:** Manual testing only for manifest creation and validation. No automated tests required for XML manifest files. [Source: [testing-strategy.md](docs/outlook-addin/architecture/testing-strategy.md#new-testing-requirements)]

**Manual Testing Checklist:**
1. **Manifest Validation:**
   - Run Office Add-in Validator on development manifest
   - Verify no validation errors or warnings
   - Verify manifest adheres to XML Schema 1.1

2. **Sideloading Test:**
   - Sideload development manifest in Outlook Web Access
   - Verify add-in icon appears in Outlook UI
   - Verify no XML parsing errors during sideload
   - Verify task pane URL points to correct localhost address

3. **Production Manifest Generation:**
   - Run `npm run manifest:prod` script
   - Verify production manifest file created
   - Verify production manifest contains `outlook-addin.zollc.com` URL (not localhost)
   - Verify production manifest validates successfully

[Source: [testing-strategy.md](docs/outlook-addin/architecture/testing-strategy.md#manual-testing-for-add-in-ui)]

**No Unit Tests Required:** This story creates XML configuration files. No backend logic or UI components implemented. Automated tests not applicable. [Source: [testing-strategy.md](docs/outlook-addin/architecture/testing-strategy.md#new-testing-requirements)]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-09 | 1.0 | Initial story creation for Story 1.4 | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

*To be filled by Dev Agent during implementation*

### Debug Log References

*To be filled by Dev Agent during implementation*

### Completion Notes List

*To be filled by Dev Agent during implementation*

### File List

*To be filled by Dev Agent during implementation*

## QA Results

*To be filled by QA Agent after implementation review*
