# Story 5.7: Enhanced Navigation & Breadcrumbs

## Status
**Not Needed**

## Story
**As a** user,
**I want** clear navigation context throughout the application,
**so that** I always know where I am and can easily navigate back.

## Acceptance Criteria
1. Breadcrumb navigation displayed on all pages below header: "Dashboard > Clients > Edit Client"
2. Each breadcrumb segment clickable to navigate to parent pages
3. Current page title displayed prominently on every page
4. Back button behavior respects navigation history (browser back works correctly)
5. Mobile navigation uses hamburger menu pattern for space efficiency
6. Keyboard navigation support: Tab through nav items, Enter to activate
7. "Skip to main content" link for accessibility (hidden but keyboard accessible)
8. Logout link visible in header/nav menu on all pages

## Tasks / Subtasks

- [ ] Task 1: Create Breadcrumb component (AC: 1, 2)
  - [ ] Create `frontend/src/components/Breadcrumb.tsx` component
  - [ ] Component accepts breadcrumb items: `{ label: string, path?: string }[]`
  - [ ] Render breadcrumbs with separator (chevron or slash)
  - [ ] Last breadcrumb (current page) not clickable, previous breadcrumbs are links
  - [ ] Style with Tailwind: text-sm, muted-foreground for links, foreground for current
  - [ ] Test: Render "Dashboard > Clients > Edit Client" → Verify first 2 clickable, last not

- [ ] Task 2: Create useBreadcrumbs hook for route-based breadcrumb generation (AC: 1, 2)
  - [ ] Create `frontend/src/hooks/useBreadcrumbs.ts` hook
  - [ ] Hook uses `useLocation()` and `useParams()` to generate breadcrumbs from route
  - [ ] Map routes to breadcrumb labels:
    - `/` → "Dashboard"
    - `/tickets` → "Dashboard > Tickets"
    - `/tickets/create` → "Dashboard > Tickets > Create Ticket"
    - `/tickets/:id` → "Dashboard > Tickets > Ticket #:id"
    - `/clients` → "Dashboard > Clients"
    - `/contacts` → "Dashboard > Contacts"
    - `/invoices` → "Dashboard > Invoices"
    - `/invoices/preview` → "Dashboard > Invoices > Preview"
    - `/settings` → "Dashboard > Settings"
  - [ ] Return breadcrumb items array with label and path
  - [ ] Test: Navigate to `/tickets/42` → Should return `[{label: "Dashboard", path: "/"}, {label: "Tickets", path: "/tickets"}, {label: "Ticket #42"}]`

- [ ] Task 3: Integrate Breadcrumb component into page layout (AC: 1, 2, 3)
  - [ ] Update `frontend/src/App.tsx` to include Breadcrumb below Navbar
  - [ ] Add Breadcrumb component inside `<main>` wrapper, before page content
  - [ ] Breadcrumb positioned: `max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-2`
  - [ ] PageHeader component already displays page title prominently (AC 3 ✓)
  - [ ] Test: Navigate to multiple pages → Breadcrumbs display correctly below header

- [ ] Task 4: Enhance keyboard navigation support (AC: 6)
  - [ ] Update `frontend/src/components/Navbar.tsx` to ensure nav links are keyboard accessible
  - [ ] Verify Tab key cycles through nav items (already functional with `<Link>`)
  - [ ] Verify Enter key activates nav links (already functional with `<Link>`)
  - [ ] Ensure mobile menu keyboard accessible (Tab to hamburger, Enter opens, Escape closes)
  - [ ] Test: Tab through nav items → Should highlight each item, Enter navigates

- [ ] Task 5: Add "Skip to main content" link for accessibility (AC: 7)
  - [ ] Add skip link at top of `frontend/src/App.tsx` before Navbar
  - [ ] Skip link: `<a href="#main-content" className="sr-only focus:not-sr-only">Skip to main content</a>`
  - [ ] Style with Tailwind: `sr-only` (hidden) but `focus:not-sr-only` (visible on keyboard focus)
  - [ ] Add `id="main-content"` to `<main>` element in App.tsx
  - [ ] Skip link positioned absolute, top-0, left-0, z-[100], white bg, px-4 py-2 when focused
  - [ ] Test: Tab on page load → Skip link appears, Enter skips to main content

- [ ] Task 6: Verify logout link visibility (AC: 8)
  - [ ] Confirm Navbar.tsx displays Logout button on desktop (already implemented ✓)
  - [ ] Confirm MobileMenu.tsx displays Logout button on mobile (already implemented ✓)
  - [ ] Test: Desktop and mobile → Logout button visible in nav

- [ ] Task 7: Verify browser back button behavior (AC: 4)
  - [ ] Confirm React Router uses BrowserRouter (already implemented ✓)
  - [ ] Test: Navigate Dashboard → Tickets → Ticket Detail, click browser back → Should return to Tickets page
  - [ ] Test: Navigate multiple pages, browser back → Should respect history stack

- [ ] Task 8: Testing (AC: all)
  - [ ] Test breadcrumbs on all pages (Dashboard, Tickets, Create Ticket, Ticket Detail, Clients, Contacts, Invoices, Preview, Settings)
  - [ ] Test breadcrumb links navigate correctly
  - [ ] Test keyboard navigation (Tab, Enter, Escape)
  - [ ] Test skip link (Tab on page load, Enter skips to content)
  - [ ] Test mobile hamburger menu (keyboard and mouse)
  - [ ] Test logout link visible on desktop and mobile
  - [ ] Test browser back button respects navigation history

## Dev Notes

### Previous Story Insights
[Source: Story 5.1, Story 5.6]
- Navbar component already exists with desktop and mobile navigation (AC 5, 8 ✓)
- Mobile navigation uses hamburger menu pattern (AC 5 ✓)
- Navbar highlights active nav item based on current route
- PageHeader component displays prominent page titles (AC 3 ✓)
- React Router uses BrowserRouter, so browser back button works correctly (AC 4 ✓)
- Keyboard navigation already functional for nav links (standard `<Link>` behavior)

**Implementation Notes:**
Story primarily focuses on adding breadcrumb navigation. Most other acceptance criteria (mobile menu, logout, browser back, page titles, keyboard nav) are already implemented.

### Relevant Source Tree
**Frontend:**
- `frontend/src/components/Breadcrumb.tsx` - **NEW** Breadcrumb component
- `frontend/src/hooks/useBreadcrumbs.ts` - **NEW** Hook for route-based breadcrumbs
- `frontend/src/App.tsx` - Update to add Breadcrumb and skip link
- `frontend/src/components/Navbar.tsx` - Existing navigation (verify keyboard support)
- `frontend/src/components/MobileMenu.tsx` - Existing mobile menu
- `frontend/src/components/PageHeader.tsx` - Existing page title component

### Component Specifications
[Source: Epic 5.7 AC, shadcn/ui patterns]

**Breadcrumb Component Interface:**
```typescript
interface BreadcrumbItem {
  label: string;
  path?: string; // Omit for current page (not clickable)
}

interface BreadcrumbProps {
  items: BreadcrumbItem[];
}

// Example usage:
<Breadcrumb
  items={[
    { label: "Dashboard", path: "/" },
    { label: "Tickets", path: "/tickets" },
    { label: "Ticket #42" } // Current page, no path
  ]}
/>
```

**Visual Design:**
- Separator: `<ChevronRight size={14} />` from lucide-react
- Text size: `text-sm`
- Link color: `text-muted-foreground hover:text-foreground`
- Current page: `text-foreground font-medium`
- Layout: Flex row with gap-2 between items

**useBreadcrumbs Hook:**
```typescript
export function useBreadcrumbs(): BreadcrumbItem[] {
  const location = useLocation();
  const params = useParams();

  // Generate breadcrumbs based on current route
  // Return array of breadcrumb items
}
```

**Route-to-Breadcrumb Mapping:**
| Route | Breadcrumbs |
|-------|-------------|
| `/` | Dashboard |
| `/tickets` | Dashboard > Tickets |
| `/tickets/create` | Dashboard > Tickets > Create Ticket |
| `/tickets/:id` | Dashboard > Tickets > Ticket #:id |
| `/clients` | Dashboard > Clients |
| `/contacts` | Dashboard > Contacts |
| `/invoices` | Dashboard > Invoices |
| `/invoices/preview` | Dashboard > Invoices > Preview |
| `/settings` | Dashboard > Settings |

### Skip to Main Content Link
[Source: WCAG 2.1 Guidelines, AC 7]

**Purpose:** Allows keyboard users to skip repetitive navigation and jump directly to main content.

**Implementation:**
```tsx
<a
  href="#main-content"
  className="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 focus:z-[100] focus:bg-background focus:text-foreground focus:px-4 focus:py-2 focus:border focus:border-border"
>
  Skip to main content
</a>
```

**Tailwind Classes Explained:**
- `sr-only`: Screen reader only (hidden visually)
- `focus:not-sr-only`: Visible when focused (keyboard Tab)
- `focus:absolute focus:top-0 focus:left-0`: Position at top-left corner
- `focus:z-[100]`: Above all other content
- `focus:bg-background focus:text-foreground`: Visible styling

**Main Content ID:**
Add `id="main-content"` to `<main>` element in App.tsx so skip link targets correct element.

### Keyboard Navigation Support
[Source: AC 6, WCAG 2.1]

**Already Implemented:**
- Nav links (`<Link>`) are keyboard accessible by default
- Tab key cycles through nav items
- Enter key activates links
- Mobile menu hamburger button is keyboard accessible

**Verify/Enhance:**
- Ensure mobile menu Escape key closes menu
- Ensure all interactive elements have visible focus indicators (Tailwind `focus:` utilities)

### Data Models
No backend data models required. Breadcrumbs generated client-side from React Router state.

### API Specifications
No API endpoints required. Frontend-only story.

### File Locations
[Source: docs/architecture/unified-project-structure.md]

**New Files:**
- `frontend/src/components/Breadcrumb.tsx` - Breadcrumb component
- `frontend/src/hooks/useBreadcrumbs.ts` - Breadcrumb generation hook

**Modified Files:**
- `frontend/src/App.tsx` - Add Breadcrumb and skip link

### Technical Constraints
[Source: docs/architecture/tech-stack.md]
- **Frontend:** React 18.3.1 + TypeScript 5.8.3
- **Routing:** react-router-dom (BrowserRouter)
- **Icons:** lucide-react library (`ChevronRight` for breadcrumb separator)
- **Styling:** Tailwind CSS utility classes
- **Accessibility:** WCAG 2.1 Level AA compliance (keyboard navigation, skip links)

### Accessibility Requirements
[Source: AC 6, 7, WCAG 2.1]

**Keyboard Navigation (AC 6):**
- All nav links accessible via Tab key
- Enter key activates links
- Focus indicators visible (Tailwind `focus:ring` or `focus:outline`)

**Skip Link (AC 7):**
- Hidden by default (`sr-only`)
- Visible on keyboard focus (`focus:not-sr-only`)
- Positioned at top of page, z-index above navigation
- Targets `#main-content` ID on `<main>` element

**Semantic HTML:**
- Use `<nav>` for breadcrumbs (`role="navigation" aria-label="Breadcrumb"`)
- Use `<ol>` or `<ul>` for breadcrumb list
- Current page marked with `aria-current="page"`

### Testing

**Test Standards:**
[Source: docs/architecture/testing-strategy.md]
- Manual browser testing for MVP
- Test on desktop (1440px+) and mobile (375px) viewports
- Test keyboard navigation (Tab, Enter, Escape)
- Test screen reader compatibility (optional, but recommended for accessibility)

**Key Test Scenarios:**

1. **Breadcrumb Display:**
   - Navigate to Dashboard → Breadcrumb: "Dashboard"
   - Navigate to Tickets page → Breadcrumb: "Dashboard > Tickets"
   - Navigate to Create Ticket → Breadcrumb: "Dashboard > Tickets > Create Ticket"
   - Navigate to Ticket Detail (ID 42) → Breadcrumb: "Dashboard > Tickets > Ticket #42"
   - Navigate to Clients → Breadcrumb: "Dashboard > Clients"
   - Test: All breadcrumbs display correct labels and separators

2. **Breadcrumb Navigation:**
   - On Ticket Detail page, click "Dashboard" breadcrumb → Navigate to Dashboard
   - On Ticket Detail page, click "Tickets" breadcrumb → Navigate to Tickets page
   - On Tickets page, verify "Tickets" breadcrumb not clickable (current page)
   - Test: Breadcrumb links navigate correctly

3. **Keyboard Navigation:**
   - Tab from page load → Skip link appears
   - Enter on skip link → Focus moves to main content
   - Tab through nav items → Each item highlighted with focus indicator
   - Enter on nav item → Navigate to page
   - Tab to mobile hamburger (mobile viewport) → Enter opens menu
   - Escape key → Close mobile menu
   - Test: All keyboard interactions work correctly

4. **Skip to Main Content:**
   - Tab immediately on page load → Skip link appears at top-left
   - Enter on skip link → Focus moves to `<main>` element, breadcrumbs bypassed
   - Tab again → Focus moves to first interactive element in main content
   - Test: Skip link functions correctly

5. **Mobile Navigation:**
   - Mobile viewport (375px) → Hamburger menu visible, desktop nav hidden
   - Click hamburger → Mobile menu opens
   - Click nav item → Navigate to page, menu closes
   - Click Logout → Logout function executes
   - Test: Mobile menu functions correctly

6. **Logout Visibility:**
   - Desktop viewport → Logout button visible in top-right corner
   - Mobile viewport → Logout button visible in mobile menu
   - Test: Logout always accessible

7. **Browser Back Button:**
   - Navigate Dashboard → Tickets → Ticket Detail
   - Click browser back → Return to Tickets page
   - Click browser back → Return to Dashboard
   - Test: Browser history respected

8. **Page Titles:**
   - Navigate to each page → Verify PageHeader displays prominent title:
     - Dashboard: "Dashboard"
     - Tickets: "Open Tickets" (with filter badge)
     - Create Ticket: "Create Ticket"
     - Ticket Detail: "Ticket #42"
     - Clients: "Clients"
     - Contacts: "Contacts"
     - Invoices: "Invoice Review"
     - Settings: "Settings"
   - Test: All pages have clear titles

**Running Tests:**
```bash
# Start development servers
npm --prefix frontend run dev
npm --prefix backend start

# Manual testing workflow
1. Login to application
2. Navigate to each page and verify breadcrumbs display correctly
3. Click breadcrumb links and verify navigation
4. Test keyboard navigation (Tab, Enter, Escape)
5. Test skip link (Tab on load, Enter to skip)
6. Test mobile menu (375px viewport)
7. Test browser back button across multiple pages
8. Verify logout button visible on desktop and mobile
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-06 | 1.0 | Initial story creation | Bob (SM Agent) |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_Not yet tested_
